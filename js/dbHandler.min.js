function dbConn(){var e=window.indexedDB.open("tmTimerDB",1);e.onerror=function(e){console.log("Database error code: "+e.target.errorCode)},e.onsuccess=function(t){db=e.result,isNewMeeting()&&clearTimetable()},e.onupgradeneeded=function(e){var t=e.currentTarget.result.createObjectStore("timeTable",{keyPath:"id",autoIncrement:!0});t.createIndex("member","member",{unique:!1}),t.createIndex("role","role",{unique:!1}),t.createIndex("time","time",{unique:!1}),t.createIndex("lastColor","lastColor",{unique:!1})}}function initializeDB(){dbConn()}function clearTimetable(){db.transaction(["timeTable"],"readwrite").objectStore("timeTable").clear()}function isNewMeeting(){var e=(new Date).toString("yyyy/MM/dd");return null===localStorage.getItem("meetingDate")?(localStorage.setItem("meetingDate",e),!0):localStorage.getItem("meetingDate")!==e&&(localStorage.removeItem("meetingDate"),localStorage.setItem("meetingDate",e),!0)}function addNewTime(e,t,o,a){db.transaction(["timeTable"],"readwrite").objectStore("timeTable").add({member:e,role:t,time:o,lastColor:a})}function countTimetable(){var e=db.transaction(["timeTable"],"readonly").objectStore("timeTable").count();e.onsuccess=function(){e.result>0?($("#hNoResults").hide(),$("#tblResults").show(),$("#tblActions").show()):($("#hNoResults").show(),$("#tblResults").hide(),$("#tblActions").hide())}}function printTable(){$("#tBodyResults").empty(),results=[],db.transaction(["timeTable"],"readwrite").objectStore("timeTable").openCursor().onsuccess=function(e){var t=e.target.result;if(t){var o="white";"yellow"!=t.value.lastColor&&"black"!=t.value.lastColor&&"white"!=t.value.lastColor||(o="black");var a=t.value.lastColor;"black"==a&&(a="white"),results.push({member:t.value.member,role:t.value.role,time:t.value.time,lastColor:t.value.lastColor}),$("#tBodyResults").append('<tr style="background:'+a+";color:"+o+'"><td>'+t.value.member+"</td><td>"+t.value.role+'</td><td style="text-align:center">'+t.value.time+"</td></tr>"),t.continue()}}}var db,results=[];window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;