var db,results=[];window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;function dbConn(){var a=window.indexedDB.open("tmTimerDB",1);a.onerror=function(b){console.log("Database error code: "+b.target.errorCode)},a.onsuccess=function(){db=a.result,isNewMeeting()&&clearTimetable()},a.onupgradeneeded=function(b){var c=b.currentTarget.result.createObjectStore("timeTable",{keyPath:"id",autoIncrement:!0});c.createIndex("member","member",{unique:!1}),c.createIndex("role","role",{unique:!1}),c.createIndex("time","time",{unique:!1}),c.createIndex("lastColor","lastColor",{unique:!1})}}function initializeDB(){dbConn()}function clearTimetable(){var a=db.transaction(["timeTable"],"readwrite"),b=a.objectStore("timeTable");b.clear()}function isNewMeeting(){var a=new Date().toString("yyyy/MM/dd");return null===localStorage.getItem("meetingDate")?(localStorage.setItem("meetingDate",a),!0):localStorage.getItem("meetingDate")!==a&&(localStorage.removeItem("meetingDate"),localStorage.setItem("meetingDate",a),!0)}function addNewTime(a,b,c,d){var e=db.transaction(["timeTable"],"readwrite"),f=e.objectStore("timeTable");f.add({member:a,role:b,time:c,lastColor:d})}function countTimetable(){var a=db.transaction(["timeTable"],"readonly"),b=a.objectStore("timeTable"),c=b.count();c.onsuccess=function(){0<c.result?($("#hNoResults").hide(),$("#tblResults").show(),$("#btnDelete").show(),$("#linkDownload").show()):($("#hNoResults").show(),$("#tblResults").hide(),$("#btnDelete").hide(),$("#linkDownload").hide())}}function printTable(){$("#tBodyResults").empty(),results=[];var a=db.transaction(["timeTable"],"readwrite"),b=a.objectStore("timeTable"),c=b.openCursor();c.onsuccess=function(d){var e=d.target.result;if(e){var f="white";("yellow"===e.value.lastColor||"black"===e.value.lastColor||"white"===e.value.lastColor)&&(f="black");var g=e.value.lastColor;"black"===g&&(g="white"),results.push({member:e.value.member,role:e.value.role,time:e.value.time,lastColor:e.value.lastColor}),$("#tBodyResults").append(`<tr style="background:${g};color:${f}"><td>${e.value.member}</td><td>${e.value.role}</td><td style="text-align:center">${e.value.time}</td></tr>`),e.continue()}}}
